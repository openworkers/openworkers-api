export default {
  // Handle HTTP requests
  // https://openworkers.com/docs/workers/event-fetch
  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
    try {
      return await handleRequest(request, env);
    } catch (err: any) {
      return new Response(err.stack, { status: 500 });
    }
  },

  // Handle scheduled events (cron)
  // https://openworkers.com/docs/workers/scheduled-tasks
  async scheduled(event: ScheduledEvent, env: Env, ctx: ExecutionContext): Promise<void> {
    console.log(`Scheduled event at ${new Date(event.scheduledTime).toISOString()}`);
  }
};

async function handleRequest(request: Request, env: Env): Promise<Response> {
  const { pathname } = new URL(request.url);

  if (pathname === "/favicon.ico") {
    return new Response("Not found", { status: 404 });
  }

  if (pathname.startsWith("/api")) {
    return Response.json({ pathname });
  }

  return new Response("<h3>Hello world!</h3>", {
    headers: { "Content-Type": "text/html" },
  });
}
